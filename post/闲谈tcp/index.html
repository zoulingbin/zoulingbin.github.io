<!doctype html>
<html lang="en-us">
  <head>
    <title>闲谈tcp // zoulingbin</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.68.3" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Dr.Zou" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://zoulingbin.github.io/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="闲谈tcp"/>
<meta name="twitter:description" content="TCP特点：   TCP是面向连接的传输层协议。在使用TCP协议之前必须先建立TCP连接，在传送数据完毕后，必须释放已经建立的tcp连接。
  TCP提供全双工通信。
  提供可靠交付。
  TCP 有拥塞控制，可以通过窗口控制对网络流量进行控制，避免网络拥塞。
  面向字节流。
  TCP连接： TCP报文首部：  源端口号：发送端端口号，占16bit。TCP协议通过使用”端口”来标识源端和目标端的应用进程。端口号可以使用0到65535之间的任何数字。 目标端口号：接收端的端口号。在收到服务请求时，操作系统动态地为客户端的应用程序分配端口号。在服务器端，每种服务在”众所周知的端口”（Well-Know Port）为用户提供服务。 序列号：序列号表示的是报文段数据中的第一个字节号，ACK表示确认号，该确认号的发送方期待接收的下一个序列号，即最后被成功接收的数据字节序列号加1，这个字段只有在ACK位被启用的时候才有效。 确认号：只有ACK标志为1时，确认号字段才有效。它包含目标端所期望收到源端的下一个数据字节。 头部长度字段：TCP 所传输的数据部分应该从 TCP 包的哪个位置开始计算，也可以将其看作 TCP 包的长度，单位为4bit。它指出TCP报文段的数据起始处距离TCP报文段的起始处有多远。 窗口：明确指出了现在允许对方发送的数据量。窗口值经常在动态变化着。窗口指的是发送本报文段的一方的接收窗口（而不是自己的发送窗口） CWR（Congestion Window Reduced）：与后面的ECE都是用于IP首部的ECN字段，为1时通知对方已将拥塞窗口缩小。 ECE（ECN-Echo）：置为1时通知通信对方，从对方到这边的网络有拥堵。 URG（Urgent Flag）：该位为1时，表示包中有需要紧急处理的数据。 ACK（Acknowledgement Flag）：该位为1时，确认应答的字段变为有效。 PSH（Push Flag）：该位为1时，表示需要将收到的数据立即传给上层应用协议，为0时则表示先不上传而是缓存起来。 RST（Reset Flag）：该位为1时，表示TCP连接中出现异常必须强制断开连接。 SYN（Synchronize Flag）：该位为1时，表示希望建立连接，并在序列号字段进行序列号初始值的设定。 FIN（Fin Flag）：该位为1时，表示今后不会再有数据发送，希望断开连接。 窗口大小：用于通知从相同 TCP 首部的确认应答号所指位置开始能够接收的数据大小。 校验值：TCP头部和TCP数据进行校验和计算，并由目标端进行验证。 紧急指针：只有在URG 控制位为1时有效，该字段数值表示本报文段中紧急数据的指针。  三次握手 客户端和服务端通信前要进行连接，“3次握手”的作用就是双方都能明确自己和对方的收、发能力是正常的。
 第一次握手:客户端发送网络包，服务端收到了。这样服务端就能得出结论：客户端的发送能力、服务端的接收能力是正常的,SYN=1,seq=x。 第二次握手:服务端发包，客户端收到了。这样客户端就能得出结论：服务端的接收、发送能力，客户端的接收、发送能力是正常的，ACK=1,ack=x&#43;1,SYN=1,seq=y。 从客户端的视角来看，我接到了服务端发送过来的响应数据包，说明服务端接收到了我在第一次握手时发送的网络包，并且成功发送了响应数据包，这就说明，服务端的接收、发送能力正常。而另一方面，我收到了服务端的响应数据包，说明我第一次发送的网络包成功到达服务端，这样，我自己的发送和接收能力也是正常的。 第三次握手:客户端发包，服务端收到了。这样服务端就能得出结论：客户端的接收、发送能力，服务端的发送、接收能力是正常的，seq=x&#43;1,ACK=1,ack=y&#43;1。  四次挥手  第一次：客户端请求断开FIN,seq=u。 第二次：服务器确认客户端的断开请求ACK,ack=u&#43;1,seq=v。 第三次：服务器请求断开FIN,seq=w,ACK,ack=u&#43;1。 第四次：客户端确认服务器的断开ACK,ack=w&#43;1,seq=u&#43;1。  "/>

    <meta property="og:title" content="闲谈tcp" />
<meta property="og:description" content="TCP特点：   TCP是面向连接的传输层协议。在使用TCP协议之前必须先建立TCP连接，在传送数据完毕后，必须释放已经建立的tcp连接。
  TCP提供全双工通信。
  提供可靠交付。
  TCP 有拥塞控制，可以通过窗口控制对网络流量进行控制，避免网络拥塞。
  面向字节流。
  TCP连接： TCP报文首部：  源端口号：发送端端口号，占16bit。TCP协议通过使用”端口”来标识源端和目标端的应用进程。端口号可以使用0到65535之间的任何数字。 目标端口号：接收端的端口号。在收到服务请求时，操作系统动态地为客户端的应用程序分配端口号。在服务器端，每种服务在”众所周知的端口”（Well-Know Port）为用户提供服务。 序列号：序列号表示的是报文段数据中的第一个字节号，ACK表示确认号，该确认号的发送方期待接收的下一个序列号，即最后被成功接收的数据字节序列号加1，这个字段只有在ACK位被启用的时候才有效。 确认号：只有ACK标志为1时，确认号字段才有效。它包含目标端所期望收到源端的下一个数据字节。 头部长度字段：TCP 所传输的数据部分应该从 TCP 包的哪个位置开始计算，也可以将其看作 TCP 包的长度，单位为4bit。它指出TCP报文段的数据起始处距离TCP报文段的起始处有多远。 窗口：明确指出了现在允许对方发送的数据量。窗口值经常在动态变化着。窗口指的是发送本报文段的一方的接收窗口（而不是自己的发送窗口） CWR（Congestion Window Reduced）：与后面的ECE都是用于IP首部的ECN字段，为1时通知对方已将拥塞窗口缩小。 ECE（ECN-Echo）：置为1时通知通信对方，从对方到这边的网络有拥堵。 URG（Urgent Flag）：该位为1时，表示包中有需要紧急处理的数据。 ACK（Acknowledgement Flag）：该位为1时，确认应答的字段变为有效。 PSH（Push Flag）：该位为1时，表示需要将收到的数据立即传给上层应用协议，为0时则表示先不上传而是缓存起来。 RST（Reset Flag）：该位为1时，表示TCP连接中出现异常必须强制断开连接。 SYN（Synchronize Flag）：该位为1时，表示希望建立连接，并在序列号字段进行序列号初始值的设定。 FIN（Fin Flag）：该位为1时，表示今后不会再有数据发送，希望断开连接。 窗口大小：用于通知从相同 TCP 首部的确认应答号所指位置开始能够接收的数据大小。 校验值：TCP头部和TCP数据进行校验和计算，并由目标端进行验证。 紧急指针：只有在URG 控制位为1时有效，该字段数值表示本报文段中紧急数据的指针。  三次握手 客户端和服务端通信前要进行连接，“3次握手”的作用就是双方都能明确自己和对方的收、发能力是正常的。
 第一次握手:客户端发送网络包，服务端收到了。这样服务端就能得出结论：客户端的发送能力、服务端的接收能力是正常的,SYN=1,seq=x。 第二次握手:服务端发包，客户端收到了。这样客户端就能得出结论：服务端的接收、发送能力，客户端的接收、发送能力是正常的，ACK=1,ack=x&#43;1,SYN=1,seq=y。 从客户端的视角来看，我接到了服务端发送过来的响应数据包，说明服务端接收到了我在第一次握手时发送的网络包，并且成功发送了响应数据包，这就说明，服务端的接收、发送能力正常。而另一方面，我收到了服务端的响应数据包，说明我第一次发送的网络包成功到达服务端，这样，我自己的发送和接收能力也是正常的。 第三次握手:客户端发包，服务端收到了。这样服务端就能得出结论：客户端的接收、发送能力，服务端的发送、接收能力是正常的，seq=x&#43;1,ACK=1,ack=y&#43;1。  四次挥手  第一次：客户端请求断开FIN,seq=u。 第二次：服务器确认客户端的断开请求ACK,ack=u&#43;1,seq=v。 第三次：服务器请求断开FIN,seq=w,ACK,ack=u&#43;1。 第四次：客户端确认服务器的断开ACK,ack=w&#43;1,seq=u&#43;1。  " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zoulingbin.github.io/post/%E9%97%B2%E8%B0%88tcp/" />
<meta property="article:published_time" content="2020-12-08T21:00:32+08:00" />
<meta property="article:modified_time" content="2020-12-08T21:00:32+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://zoulingbin.github.io"><img class="app-header-avatar" src="/avatar.jpg" alt="Dr.Zou" /></a>
      <h1>zoulingbin</h1>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Posts</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
      </nav>
      <p>几多人位于山之巅俯瞰我的疲倦</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/zoulingbin" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">闲谈tcp</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Dec 8, 2020
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          1 min read
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
              <a class="tag" href="https://zoulingbin.github.io/tags/tcp/">tcp</a>
              <a class="tag" href="https://zoulingbin.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h4 id="tcp特点">TCP特点：</h4>
<ul>
<li>
<p>TCP是<strong>面向连接的传输层协议</strong>。在使用TCP协议之前必须先<a href="#%E8%BF%9E%E6%8E%A5">建立TCP连接</a>，在传送数据完毕后，必须释放已经建立的tcp连接。</p>
</li>
<li>
<p>TCP提供<strong>全双工通信</strong>。</p>
</li>
<li>
<p>提供可靠交付。</p>
</li>
<li>
<p>TCP 有拥塞控制，可以通过窗口控制对网络流量进行控制，避免网络拥塞。</p>
</li>
<li>
<p>面向<strong>字节流</strong>。</p>
</li>
</ul>
<h4 id="span-id连接tcp连接span"><!-- raw HTML omitted -->TCP连接<!-- raw HTML omitted -->：</h4>
<p><strong>TCP报文首部：</strong>
<img src="https://note.youdao.com/yws/api/personal/file/WEB85d815296c3ec16b55f6d70cf93c4e19?method=download&amp;shareKey=1c4927621a2198752ea62a17078ba809" alt="image"></p>
<ul>
<li>源端口号：发送端端口号，占16bit。TCP协议通过使用”端口”来标识源端和目标端的应用进程。端口号可以使用0到65535之间的任何数字。</li>
<li>目标端口号：接收端的端口号。在收到服务请求时，操作系统动态地为客户端的应用程序分配端口号。在服务器端，每种服务在”众所周知的端口”（Well-Know Port）为用户提供服务。</li>
<li>序列号：序列号表示的是报文段数据中的第一个字节号，ACK表示确认号，该确认号的发送方期待接收的下一个序列号，即最后被成功接收的数据字节序列号加1，这个字段只有在ACK位被启用的时候才有效。</li>
<li>确认号：只有<code>ACK</code><strong>标志为1时</strong>，确认号字段才有效。它包含目标端所期望收到源端的下一个数据字节。</li>
<li>头部长度字段：TCP 所传输的数据部分应该从 TCP 包的哪个位置开始计算，也可以将其看作 TCP 包的长度，单位为4bit。它指出TCP报文段的数据起始处距离TCP报文段的起始处有多远。</li>
<li>窗口：明确指出了现在允许对方发送的数据量。窗口值经常在动态变化着。窗口指的是发送本报文段的一方的接收窗口（而不是自己的发送窗口）</li>
<li>CWR（Congestion Window Reduced）：与后面的ECE都是用于IP首部的ECN字段，为1时通知对方已将拥塞窗口缩小。</li>
<li>ECE（ECN-Echo）：置为1时通知通信对方，从对方到这边的网络有拥堵。</li>
<li><!-- raw HTML omitted -->URG<!-- raw HTML omitted -->（Urgent Flag）：该位为1时，表示包中有需要紧急处理的数据。</li>
<li>ACK（Acknowledgement Flag）：该位为1时，确认应答的字段变为有效。</li>
<li>PSH（Push Flag）：该位为1时，表示需要将收到的数据立即传给上层应用协议，为0时则表示先不上传而是缓存起来。</li>
<li>RST（Reset Flag）：该位为1时，表示TCP连接中出现异常必须<strong>强制断开连接</strong>。</li>
<li>SYN（Synchronize Flag）：该位为1时，表示希望建立连接，并在序列号字段进行序列号初始值的设定。</li>
<li>FIN（Fin Flag）：该位为1时，表示今后<strong>不会再有数据发送，希望断开连接</strong>。</li>
<li>窗口大小：用于通知从相同 TCP 首部的确认应答号所指位置开始能够接收的数据大小。</li>
<li>校验值：TCP头部和TCP数据进行校验和计算，并由目标端进行验证。</li>
<li>紧急指针：只有在<a href="#URG">URG 控制位</a>为1时有效，该字段数值表示本报文段中紧急数据的指针。</li>
</ul>
<h3 id="三次握手">三次握手</h3>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBb57c13feaa659dea8d23c2883ace4a6e?method=download&amp;shareKey=de32449b437f87eba26844e6c222a92b" alt="image">
客户端和服务端通信前要进行连接，“3次握手”的作用就是双方都能明确自己和对方的收、发能力是正常的。</p>
<ul>
<li><code>第一次握手</code>:客户端发送网络包，服务端收到了。这样服务端就能得出结论：客户端的发送能力、服务端的接收能力是正常的,<code>SYN=1,seq=x</code>。</li>
<li><code>第二次握手</code>:服务端发包，客户端收到了。这样客户端就能得出结论：服务端的接收、发送能力，客户端的接收、发送能力是正常的，<code>ACK=1,ack=x+1,SYN=1,seq=y</code>。
从客户端的视角来看，我接到了服务端发送过来的响应数据包，说明服务端接收到了我在第一次握手时发送的网络包，并且成功发送了响应数据包，这就说明，服务端的接收、发送能力正常。而另一方面，我收到了服务端的响应数据包，说明我第一次发送的网络包成功到达服务端，这样，我自己的发送和接收能力也是正常的。</li>
<li><code>第三次握手</code>:客户端发包，服务端收到了。这样服务端就能得出结论：客户端的接收、发送能力，服务端的发送、接收能力是正常的，<code>seq=x+1,ACK=1,ack=y+1</code>。</li>
</ul>
<h3 id="四次挥手">四次挥手</h3>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBe24e239db542291953edb4413a7707d7?method=download&amp;shareKey=42bb531c529213868d6cb08264c59952" alt="image"></p>
<ul>
<li><code>第一次</code>：客户端请求断开FIN,<code>seq=u</code>。</li>
<li><code>第二次</code>：服务器确认客户端的断开请求ACK,<code>ack=u+1,seq=v</code>。</li>
<li><code>第三次</code>：服务器请求断开FIN,<code>seq=w,ACK,ack=u+1</code>。</li>
<li><code>第四次</code>：客户端确认服务器的断开ACK,<code>ack=w+1,seq=u+1</code>。</li>
</ul>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
